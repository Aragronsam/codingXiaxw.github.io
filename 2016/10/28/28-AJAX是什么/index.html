<!DOCTYPE html>
<html>

<!-- Head tag -->

<head>
 	 <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Life is short,just coding.">
    <meta name="keyword"  content="undefined">
    <title>玩转AJAX | Stephen&#39;s blog</title>
    <!-- Favicon -->
    <link rel="Shortcut Icon" href="/favicon.ico">

    <!-- css files -->
    <link rel="stylesheet" href="/css/app.css">
    <link rel="stylesheet" href="/css/normalize.css">
    <link rel="stylesheet" href="/css/font-awesome.min.css">

</head>

<body>
	<!-- header -->
	<header class="header">
    <section class="banner">
        <div class="banner-image">
            <img src="http://7xl0rs.com1.z0.glb.clouddn.com/banner.png" alt="banner">
        </div>
        <img class="avatar" src="http://7xl0rs.com1.z0.glb.clouddn.com/avatar.png" alt="avatar" >
    </section>

    <nav class="nav">
    
    	<a href="/">Home</a>
    
    	<a href="/archives">Archives</a>
    
    	<a href="/about">About</a>
    
    	<a href="/atom.xml">Rss</a>
    
    </nav>
    <button class="menu-toggle">
        <div class="nav-bar">
             
                <a href="/">Home</a>
            
                <a href="/archives">Archives</a>
            
                <a href="/about">About</a>
            
                <a href="/atom.xml">Rss</a>
            
        </div>
    </button>
    
</header>

	<!-- Main content -->
	<main class="post">

	<article>
	<h1 class="article-title">
	   玩转AJAX
	</h1>

	<section class="post-time">
		<span class="post-date">10-28</span>
	</section>

	<section class="article-entry">
	    <p>客户端向服务器发送请求，若服务器每次响应过来的结果都要重新加载整个界面的话这样会给服务器带来很大的压力。所以ajax出现了，它是在不重新加载整个页面的情况下与服务器交换数据并更新部分网页的技术，是一种使用现有标准的新方法。  </p>
<a id="more"></a>
<h2 id="AJAX是什么"><a href="#AJAX是什么" class="headerlink" title="AJAX是什么"></a>AJAX是什么</h2><p>1.asynchronous javascript and xml，翻译过来就是异步的js和xml。2.它能使用js语言访问服务器，而且是异步访问。3.服务器给客户端的响应一般是整个页面，一个html完整页面但在ajax中因为是局部刷新，那么服务器就不用再响应整个页面而只是响应局部。  </p>
<h2 id="服务器向客户端返回的数据类型"><a href="#服务器向客户端返回的数据类型" class="headerlink" title="服务器向客户端返回的数据类型"></a>服务器向客户端返回的数据类型</h2><p>一般客户端向服务器发送请求，服务器返回的数据类型有三种:  </p>
<ul>
<li>1.text类型:返回的数据是纯文本。</li>
<li>2.xml类型:返回的数据是xml格式，它是提供js和java交互的数据格式</li>
<li>3.json类型:它也是提供js和java交互的数据格式，在ajax中最受欢迎。</li>
</ul>
<h2 id="理解同步交互和异步交互"><a href="#理解同步交互和异步交互" class="headerlink" title="理解同步交互和异步交互"></a>理解同步交互和异步交互</h2><ul>
<li>同步交互:<ul>
<li>1.发一个请求，就要等待服务器的响应结束，然后才能发送第二个请求。</li>
<li>2刷新的是整个页面。</li>
</ul>
</li>
<li>异步交互:<ul>
<li>1.发一个请求，无需等待服务器的响应，然后就可以发第二个请求。</li>
<li>2.可以使用js来接受服务器的响应，然后使用js来局部刷新界面。</li>
</ul>
</li>
</ul>
<p>附上uml图解释这两者的区别:<br><img src="http://od2xrf8gr.bkt.clouddn.com/ajax.png" alt=""></p>
<h2 id="ajax常见应用情景"><a href="#ajax常见应用情景" class="headerlink" title="ajax常见应用情景"></a>ajax常见应用情景</h2><ul>
<li>1.搜索引擎:在搜索引擎中输入关键字，会出现一个下拉框，列出网络上与关键字相关的字眼。</li>
<li>2.注册:注册页面上填写完用户名后移开光标，会显示该用户名是否已被注册。</li>
<li>3.淘宝某个店铺下方的评论框:翻页时的异步操作。</li>
</ul>
<h2 id="ajax的优缺点"><a href="#ajax的优缺点" class="headerlink" title="ajax的优缺点"></a>ajax的优缺点</h2><ul>
<li>优点:<ul>
<li>异步交互，增强了用户的体验。</li>
<li>性能:因为服务器无需再响应整个页面，只需要响应部分内容，所以服务器的压力减轻了。</li>
</ul>
</li>
<li>缺点:<ul>
<li>ajax不能应用在所有场景</li>
<li>ajax无端的增多了对服务器的访问次数，给服务器带来了压力(比较上述优点，在减少了服务器压力的同时又给服务器带来了压力，不知你理不理解哈哈)</li>
</ul>
</li>
</ul>
<h2 id="如何使用ajax来发送异步请求"><a href="#如何使用ajax来发送异步请求" class="headerlink" title="如何使用ajax来发送异步请求"></a>如何使用ajax来发送异步请求</h2><h3 id="第一步-首先要得到XMLHttpRequest"><a href="#第一步-首先要得到XMLHttpRequest" class="headerlink" title="第一步(首先要得到XMLHttpRequest)"></a>第一步(首先要得到XMLHttpRequest)</h3><p>大多数浏览器都只是得到该对象的方法为:var xmlHttp=new XMLHttpRequest();  </p>
<p>IE6.0得到的方法为:var xmlHttp = new ActiveXObject(“Msxml2.XMLHTTP”);  </p>
<p>IE5.0以及更早版本的IE:var xmlHttp=new ActiveXObject(“Microsoft.XMLHTTP”);</p>
<p>在\<script>中编写创建XMLHttpRequest对象的函数:  </p>
<pre><code>function createXMLHttpRequest(){
        try{
            return new XMLHttpRequest();
        }catch(e){
            try{
                return new ActiveXObject(“Msxml2.XMLHTTP”);
            }catch(e){
                try{
                    return new ActiveXObject(“Microsoft.XMLHTTP”);
                }catch(e){
                    alert(“哥们，你用的是什么浏览器啊”);
                    throw e;
                }
            }
        }
    }
</code></pre><h3 id="第二步-打开与服务器的连接"><a href="#第二步-打开与服务器的连接" class="headerlink" title="第二步(打开与服务器的连接)"></a>第二步(打开与服务器的连接)</h3><p>xmlHttp.open(“”,””,boolean):用来打开与服务器的连接，它需要三个参数。1.请求参数，可以是get可以是post。2.请求的url:指定服务器端资源。3.请求是否异步，如果为true表示发送异步请求，否则发送同步请求。例如xmlHttp.open(“GET”,”项目名称/AServlet”,true);</p>
<h3 id="第三步-发送请求"><a href="#第三步-发送请求" class="headerlink" title="第三步(发送请求)"></a>第三步(发送请求)</h3><p>xmlHttp.send(参数):参数为请求体内容。如果请求方式是get，则参数为null(不可以省略null)，因为get请求方式的请求体为空;如果请求方式为post，则参数为请求体，另外还需要在此方法前面增加一个<code>mlHttp.setRequestHeader(“Content-Type”,”application/x-www-form-urlencoded”);</code>设置请求头的方法。</p>
<h3 id="第四步"><a href="#第四步" class="headerlink" title="第四步"></a>第四步</h3><p>给xmlHttp对象注册onreadystatechange监听器，这个方法用于接收从服务器发送过来的响应数据。 在该方法中需要做以下步骤: </p>
<p>1.获取xmlHttp对象的状态，xmlHttp对象一共有5个状态:  </p>
<ul>
<li>0状态:表示xmlHttp对象刚创建，还没有调用open()方法。</li>
<li>1状态：请求开始，调用了open方法，但还没有调用send方法</li>
<li>2状态：调用完了send方法</li>
<li>3状态：服务器已经开始响应，但不表示响应结束了。</li>
<li>4状态：服务器响应结束(通常我们只关心这个状态)</li>
</ul>
<p>该状态通过调用xmlHttp.readyState得到。  </p>
<p>2.得到服务器响应的状态码:通过调用xmlHttp.status得到，例如200，404，500。  </p>
<p>3.得到服务器响应的内容，由于服务器返回的类型不同，所以得到的内容类型也不同，以下3种类型采用3种方法得到: </p>
<ul>
<li>var content=xmlHttp.responseText;//服务器返回的文本为text。</li>
<li>var content=xmlHttp.responseXML;//服务器响应的文本为xml内容。xmlHttp会自动对xml文本进行解析，得到的content为document对象。</li>
<li>var content=eval(“(“+xmlHttp.responsetext+”)”);//服务器返回的文本为json数据。  </li>
</ul>
<p>完成第四步我们需要写的完整代码为:</p>
<pre><code>xmlHttp.onreadystatechange=function(){//xmlHttp的5种状态都会调用本方法
    if(xmlHttp.readState==4&amp;&amp;xmlHttp.status==200){//双重判断:判断是否为4状态，而且还要判断是否为200
        //获取服务器的响应内容
        var content=xmlHttp.responseText;//或var content= xmlHttp.responseXML;
    }
} 
</code></pre><h2 id="案例-省市联动"><a href="#案例-省市联动" class="headerlink" title="案例:省市联动"></a>案例:省市联动</h2><p>说明，该案例就是在网页上显示两个下拉列表，一个列表用于显示中国所有的省份，一个列表用于显示相应省份下的城市，当然这些数据是存在数据库中的，为了方便展示，我只在数据库中列举了两个省份和部分城市。</p>
<p>domain包下的city.java和province.java代码如下:   </p>
<p><img src="http://od2xrf8gr.bkt.clouddn.com/province.png" alt=""><br><img src="http://od2xrf8gr.bkt.clouddn.com/city.png" alt=""></p>
<p>servlet包下的CityServlet.java与ProvinceServlet.java，用于向客户端发送响应数据代码如下:   </p>
<p><img src="http://od2xrf8gr.bkt.clouddn.com/cityservlet.png" alt=""><br><img src="http://od2xrf8gr.bkt.clouddn.com/provinceservlet.png" alt=""></p>
<p>dao包下的ProvinceDao.java代码如下:用于与数据库连接:  </p>
<p><img src="http://od2xrf8gr.bkt.clouddn.com/provincedao.png" alt=""></p>
<p>最终要的界面代码关于ajax的操作,代码如下:  </p>
<p><img src="http://od2xrf8gr.bkt.clouddn.com/ajax1.png" alt=""><br><img src="http://od2xrf8gr.bkt.clouddn.com/ajax2.png" alt=""><br><img src="http://od2xrf8gr.bkt.clouddn.com/ajax3.png" alt=""></p>
<p>数据库中的表有两张，一张是省份表province,一张是城市表city,如下:   </p>
<p><img src="http://od2xrf8gr.bkt.clouddn.com/city2.png" alt=""><br><img src="http://od2xrf8gr.bkt.clouddn.com/province2.png" alt=""></p>
<p>结果如下:  </p>
<p><img src="http://od2xrf8gr.bkt.clouddn.com/jiemian.png" alt=""></p>
<p>当选择了相应的省份时，ajax会立即向服务器发送请求，然后服务器返回该省份下所有的城市，ajax将这些城市动态的显示在”请选择城市”列表中。达到部分刷新界面的效果。</p>
<h2 id="联系"><a href="#联系" class="headerlink" title="联系"></a>联系</h2><p>  If you have some questions after you see this article,you can tell your doubts in the comments area or you can find some info by  clicking these links.</p>
<ul>
<li><p><a href="codingxiaxw.cn">Blog@codingXiaxw’s blog</a></p>
</li>
<li><p><a href="http://weibo.com/u/5023661572?from=hissimilar_home&amp;refer_flag=1005050003_">Weibo@codingXiaxw</a></p>
</li>
<li><p><a href="http://www.zhihu.com/people/e9f78fa34b8002652811ac348da3f671">Zhihu@codingXiaxw</a>  </p>
</li>
<li><a href="https://github.com/codingXiaxw">Github@codingXiaxw</a></li>
</ul>
</script></p>
	</section>	
</article>

</main>

	<!-- footer -->
	<footer>
	<div class="social">
		<a href="https://twitter.com">
			<i class="fa fa-twitter fa-2x" aria-hidden="true"></i>
		</a>
		<a href="https://github.com/stephenLYao">
			<i class="fa fa-github fa-2x" aria-hidden="true"></i>
		</a>
		<a href="http://www.weibo.com/3103316530/profile?rightmod=1&wvr=6&mod=personinfo">
			<i class="fa fa-weibo fa-2x" aria-hidden="true"></i>
		</a>
	</div>
	<p>@2016.Power by <a rel="nofollow"  href="https://hexo.io">Hexo</a>. Theme <a rel="nofollow" href="https://github.com/stephenLYao/hexo-theme-fresh.git">fresh</p>
</footer>


	
	<!-- js -->
	<script type="text/javascript" src="https://cdn.bootcss.com/zepto/1.2.0/zepto.min.js"></script>
	<script src="/js/toggle.js"></script>
</body>
</html>