<!DOCTYPE html>
<html>

<!-- Head tag -->

<head>
 	 <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Life is short,just coding.">
    <meta name="keyword"  content="undefined">
    <title>用Java实现网络爬虫三之开始爬取 | Stephen&#39;s blog</title>
    <!-- Favicon -->
    <link rel="Shortcut Icon" href="/favicon.ico">

    <!-- css files -->
    <link rel="stylesheet" href="/css/app.css">
    <link rel="stylesheet" href="/css/normalize.css">
    <link rel="stylesheet" href="/css/font-awesome.min.css">

</head>

<body>
	<!-- header -->
	<header class="header">
    <section class="banner">
        <div class="banner-image">
            <img src="http://7xl0rs.com1.z0.glb.clouddn.com/banner.png" alt="banner">
        </div>
        <img class="avatar" src="http://7xl0rs.com1.z0.glb.clouddn.com/avatar.png" alt="avatar" >
    </section>

    <nav class="nav">
    
    	<a href="/">Home</a>
    
    	<a href="/archives">Archives</a>
    
    	<a href="/about">About</a>
    
    	<a href="/atom.xml">Rss</a>
    
    </nav>
    <button class="menu-toggle">
        <div class="nav-bar">
             
                <a href="/">Home</a>
            
                <a href="/archives">Archives</a>
            
                <a href="/about">About</a>
            
                <a href="/atom.xml">Rss</a>
            
        </div>
    </button>
    
</header>

	<!-- Main content -->
	<main class="post">

	<article>
	<h1 class="article-title">
	   用Java实现网络爬虫三之开始爬取
	</h1>

	<section class="post-time">
		<span class="post-date">10-23</span>
	</section>

	<section class="article-entry">
	    <p>下面的代码用于爬取知乎推荐页面的所有问题、问题描述、地址、回答内容，爬取地址为<a href="http://www.zhihu.com/explore/recommendations" target="_blank" rel="external">http://www.zhihu.com/explore/recommendations</a>   </p>
<p>项目源代码见我<a href="https://github.com/codingXiaxw/Crawler" target="_blank" rel="external">github上的project</a></p>
<a id="more"></a>
<h2 id="代码介绍"><a href="#代码介绍" class="headerlink" title="代码介绍"></a>代码介绍</h2><p>1.新建Zhihu.java类，它是一个JavaBean类，用于封装我们需要得到的内容。代码如下:  </p>
<p><img src="http://od2xrf8gr.bkt.clouddn.com/zhihu.png" alt="">  </p>
<p>2.新建Spider.java类包括两个方法:  </p>
<ul>
<li>String sendGet(String url):用于获取网页源码。<br><img src="http://od2xrf8gr.bkt.clouddn.com/sendget.png" alt="">  </li>
</ul>
<p>打印出result可以得到网页的源码，会看到下面这一串串代码:<br><img src="http://od2xrf8gr.bkt.clouddn.com/source.png" alt="">  </p>
<p>找到我们需要爬取的标题那一块，可以看到:<br><img src="http://od2xrf8gr.bkt.clouddn.com/lianjie.png" alt="">  </p>
<p>href=””中的内容即是标题的地址链接，而<a></a>中的内容即是我们需要的标题。那我们该如何使用正则表达式爬取到这些内容呢？标题可以使用<code>&quot;question_link.+?&gt;(.+?)&lt;&quot;</code>来匹配得到，而链接可以使用<code>&quot;&lt;h2&gt;.+?question_link.+?href=\&quot;(.+?)\&quot;.+?&lt;/h2&gt;&quot;</code>来匹配得到。下面我们就来看看Spide.java中的第二个方法，如何匹配我们我们的内容。</p>
<ul>
<li>ArrayList<zhihu> regexString(String targetStr,String regex):用于将正则表达式和网页源码进行匹配，将得到的内容封装到Zhihu对象中，然后将对象加入到集合lists中，返回集合。</zhihu></li>
</ul>
<p><img src="http://od2xrf8gr.bkt.clouddn.com/regexstring.png" alt=""></p>
<p>最后我们只需要定义一个测试类，先调用Spider的sendGet(String url)方法中传入目标网页url并得到返回的网页源码，然后调用Spider的regexString(String target)方法得到返回的Zhihu对象的集合，然后将这些内容打印出来，即可看到我们爬取到的内容。  </p>
<p>测试类:<br><img src="http://od2xrf8gr.bkt.clouddn.com/test.png" alt="">  </p>
<p>打印出的内容:<br><img src="http://od2xrf8gr.bkt.clouddn.com/lianjie2.png" alt=""> </p>
<p>这样我们便实现了从一个页面上爬取到我们所需信息的网络爬虫。如何进阶呢？  </p>
<p>问题分析:  </p>
<ul>
<li>1.从打印台的信息我们可以发现，我们爬取到的问题地址链接并不是属于问题的地址链接，而是属于回答的地址链接，那么这里我们就需要截掉链接后半部分的”/answer/数字”部分。  <blockquote>
<p>解决方法如下:对爬取到的链接采取二次正则表达式的方法进行再一次匹配，需要匹配的字符串即为<code>/question/数字部分</code>，这样我们就将链接作为目标字符串，将该数字部分作为正则表达式即可。代码如下:  </p>
<pre><code>在Zhihu.java文件下添加方法:
boolean getRealUrl(String url)
{
    String regex=&quot;question/(.+?)/&quot;;
    Pattern pattern=Pattern.compile(regex);
    Matcher matcher=pattern.matcher(url);
        while (matcher.find())
        {
            zhihuUrl=&quot;http://www.zhihu.com/question/&quot;+matcher.group(1);
            return true;
        }
    return false;
}
</code></pre></blockquote>
</li>
</ul>
<ul>
<li><p>2.我们爬取的只是一个页面的相关内容，并没有发挥爬虫的真正强大之处。所以接下来我们就将从该页面爬取到的链接作为二次起始链接。只需在Zhihu.java的构造函数里添加如下方法即可:  </p>
<pre><code>if (getRealUrl(url))
{
    System.out.println(&quot;正在抓取链接&quot;+zhihuUrl);

    String content=Spider.sendGet(zhihuUrl);

    Pattern pattern;
    Matcher matcher;

    pattern=Pattern.compile(&quot;zh-question-title.+?&lt;h2.+?&gt;(.+?)&lt;/h2&gt;&quot;);
    matcher=pattern.matcher(content);
    if (matcher.find()) {
        title = matcher.group(1);
    }

    pattern=Pattern.compile(&quot;zh-question-detail.+?&lt;div.+?&gt;(.*?)&lt;/div&gt;&quot;);
    matcher=pattern.matcher(content);
    if (matcher.find()) {
        titleDescription=matcher.group(1);
    }

    pattern=Pattern.compile(&quot;/answer/content.+?&lt;div.+?&gt;(.*?)&lt;/div&gt;&quot;);
    matcher=pattern.matcher(content);
    while (matcher.find())
    {
        answers.add(matcher.group(1));
    }

}
</code></pre></li>
</ul>
<p>这样当我们在Spider类的regexString()方法里，每当用构造方法创建一个Zhihu对象时就会执行上述代码生成从一个链接爬取到的文章标题、内容、标题描述即回答内容并封装到该Zhihu对象里，然后继续执行Spider后面的代码时将该对象添加至list集合中。  </p>
<p>最后打印出的内容如下:<br><img src="http://od2xrf8gr.bkt.clouddn.com/printi2.png" alt=""></p>
<p>项目源代码见我<a href="https://github.com/codingXiaxw/Crawler" target="_blank" rel="external">Github</a>,地址为 <a href="https://github.com/codingXiaxw/Crawler" target="_blank" rel="external">https://github.com/codingXiaxw/Crawler</a>  </p>
<h2 id="联系"><a href="#联系" class="headerlink" title="联系"></a>联系</h2><p>  If you have some questions after you see this article,you can tell your doubts in the comments area or you can find some info by  clicking these links.</p>
<ul>
<li><p><a href="codingxiaxw.cn">Blog@codingXiaxw’s blog</a></p>
</li>
<li><p><a href="http://weibo.com/u/5023661572?from=hissimilar_home&amp;refer_flag=1005050003_" target="_blank" rel="external">Weibo@codingXiaxw</a></p>
</li>
<li><p><a href="http://www.zhihu.com/people/e9f78fa34b8002652811ac348da3f671" target="_blank" rel="external">Zhihu@codingXiaxw</a>  </p>
</li>
<li><a href="https://github.com/codingXiaxw" target="_blank" rel="external">Github@codingXiaxw</a></li>
</ul>

	</section>	
</article>

</main>

	<!-- footer -->
	<footer>
	<div class="social">
		<a href="https://twitter.com">
			<i class="fa fa-twitter fa-2x" aria-hidden="true"></i>
		</a>
		<a href="https://github.com/stephenLYao">
			<i class="fa fa-github fa-2x" aria-hidden="true"></i>
		</a>
		<a href="http://www.weibo.com/3103316530/profile?rightmod=1&wvr=6&mod=personinfo">
			<i class="fa fa-weibo fa-2x" aria-hidden="true"></i>
		</a>
	</div>
	<p>@2016.Power by <a rel="nofollow"  href="https://hexo.io">Hexo</a>. Theme <a rel="nofollow" href="https://github.com/stephenLYao/hexo-theme-fresh.git">fresh</p>
</footer>


	
	<!-- js -->
	<script type="text/javascript" src="https://cdn.bootcss.com/zepto/1.2.0/zepto.min.js"></script>
	<script src="/js/toggle.js"></script>
</body>
</html>